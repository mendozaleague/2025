<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE 2025 MENDOZA STAKES</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: white;
            min-height: 100vh;
            padding: 10px;
            color: #2c2c2c;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #feed85;
            border: 2px solid #feed85;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: black;
            line-height: 1.2;
        }
        
        .header p {
            font-size: 0.9rem;
            color: black;
            line-height: 1.3;
        }
        
        .header .race-title {
            font-weight: bold;
            font-style: italic;
            margin-bottom: 5px;
        }
        
        .info-box {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
        }
        
        .info-box p {
            font-size: 0.9rem;
            color: #2c2c2c;
            line-height: 1.4;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .info-box a {
            color: #2c2c2c;
            text-decoration: underline;
        }
        
        .mendoza-line-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #2c2c2c;
            font-weight: bold;
            font-size: 1.4rem;
        }
        
        .mendoza-line-divider::before,
        .mendoza-line-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: calc(50% - 130px);
            height: 2px;
            background-color: #2c2c2c;
        }
        
        .mendoza-line-divider::before {
            left: 0;
        }
        
        .mendoza-line-divider::after {
            right: 0;
        }
        
        .hits-squares-text {
            text-align: center;
            margin: 20px 0;
            font-size: 2rem;
            font-weight: bold;
            font-style: italic;
            font-family: 'Brush Script MT', cursive, 'Arial', sans-serif;
            color: #2c2c2c;
        }
        
        .copyright {
            text-align: center;
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.8;
            color: #cc99cc;
        }
        
        .copyright a {
            color: #cc99cc;
            text-decoration: underline;
        }
        
        .loading {
            text-align: center;
            font-size: 1.1rem;
            margin: 30px 0;
        }
        
        .player-row {
            display: flex;
            align-items: center;
            padding: 15px 12px;
            border-bottom: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .player-row.first-place {
            background: black;
            color: #feed89;
        }
        
        .player-row.second-place {
            background: #feed89;
            color: black;
        }
        
        .player-row.odd-place {
            background: black;
            color: #feed89;
        }
        
        .player-row.even-place {
            background: #feed89;
            color: black;
        }
        
        .player-row:hover {
            transform: translateX(2px);
        }
        
        .player-row:last-child {
            border-bottom: none;
        }
        
        .rank {
            font-size: 1.4rem;
            font-weight: bold;
            width: 35px;
            text-align: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .player-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 0;
        }
        
        .player-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 3px;
            line-height: 1.2;
        }
        
        .player-team {
            font-size: 0.75rem;
            opacity: 0.8;
            line-height: 1.2;
        }
        
        .batting-stats {
            text-align: right;
            flex-shrink: 0;
        }
        
        .batting-display {
            font-size: 1.4rem;
            font-weight: bold;
            line-height: 1.2;
        }
        
        .key-and-minimum {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 0.8rem;
            color: black;
            margin-left: 12px;
            margin-right: 12px;
        }
        
        .key-note {
            text-align: left;
        }
        
        .minimum-note {
            text-align: right;
        }
        
        .error {
            text-align: center;
            color: black;
            font-size: 1rem;
            margin: 30px 0;
            padding: 15px;
            background: #feed85;
            border: 1px solid #feed89;
        }
        
        .flash-red {
            animation: flashRed 2s ease-out;
        }
        
        .flash-green {
            animation: flashGreen 2s ease-out;
        }
        
        @keyframes flashRed {
            0% { background-color: inherit; }
            20% { background-color: #ff4444; }
            100% { background-color: inherit; }
        }
        
        @keyframes flashGreen {
            0% { background-color: inherit; }
            20% { background-color: #44ff44; }
            100% { background-color: inherit; }
        }
        
        .event-emoji {
            font-size: 1.2rem;
            margin-left: 8px;
            animation: eventPulse 2s ease-out;
        }
        
        @keyframes eventPulse {
            0% { opacity: 0; transform: scale(0.5); }
            20% { opacity: 1; transform: scale(1.2); }
            40% { transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .header p {
                font-size: 0.85rem;
            }
            
            .mendoza-line-divider {
                font-size: 1.2rem;
            }
            
            .mendoza-line-divider::before,
            .mendoza-line-divider::after {
                width: calc(50% - 110px);
            }
            
            .hits-squares-text {
                font-size: 1.8rem;
            }
            
            .player-row {
                padding: 12px 10px;
            }
            
            .rank {
                font-size: 1.2rem;
                width: 30px;
                margin-right: 10px;
            }
            
            .player-name {
                font-size: 1rem;
            }
            
            .player-team {
                font-size: 0.7rem;
            }
            
            .batting-display {
                font-size: 1.2rem;
            }
            
            .key-and-minimum {
                margin-left: 10px;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><strong><span>üèá‚öæüí∏</span> 2025 <span>üèá‚öæüí∏</span><br>MENDOZA STAKES</strong></h1>
            <p class="race-title"><strong><em>2nd Annual Bob Uecker Memorial Race to .200</em></strong></p>
            <p><strong>LIVE</strong> standings updated: <span id="headerTimestamp">Loading...</span></p>
        </div>
        
        <div id="content">
            <div class="loading">Loading player data...</div>
        </div>
        
        <div class="info-box">
            <p>For more info, consult our <a href="https://dudlawson.com/LEDE2025" target="_blank">Racing Form</a><br>or contact <a href="mailto:commish@mendozaleague.com?subject=Your ideas are intriguing to me, and I wish to subscribe to your newsletter.">your loyal Commissioner</a>.</p>
        </div>
        <div class="copyright">mendozaleague.com ¬© 2025 your pal <a href="https://www.dudlawson.com" target="_blank">Dud Lawson</a></div>
    </div>

    <script>
        const randomPhrases = [
            'Hits are for Squares!',
            'Stakes is Mid',
            'As Above | So Below',
            'Your Perfect Fantasy',
            'This is My Fantasy',
            'Best we can do is our Worst',
            'Not so Good ain\'t so Bad',
            'Not so Bad ain\'t so Good',
            '<span style="font-style: normal;">‚ë™</span> M. Mendoza .215/1337',
            '<span style="font-style: normal;">‚ë®</span> B. Uecker .200/731',
            '...It\'s a Shame!',
            'It\'s Good to be Okay',
            'Someone hire Tony Rizzo',
            'Greetings from the Middle West',
            'Shoutout to Josep Oller',
            'Happy International Bookie Appreciation Day',
            'Manny Ramirez hit .170 his rookie year',
            'So it Goes!',
            'Batting & Nothingness',
            'Root for Nothing!',
            'Out, out, damn\'ed shortstop!',
            'Don\'t trust Robots',
            'Hang the D.H.',
            'Reinstate The Shift',
            'Don\'t touch \'em at all!',
            'We miss Jason Benetti',
            'Trim those sideburns!',
            'No one can give more than 100%\nby definition that is the most anyone can give',
            'Peanuts & Cracker Jack is redundant',
            'Citizens United for Better Snacks',
            'I don\'t care about The Pope',
            'All Star Break Ticket Sales open July 14‚Äì17',
            'Our 10th Glorious Season',
            'What\'s the Mendoza Line for pitchers?',
            '<span style="font-style: normal;">„äµ</span> B. Colon .084/299',
            '...& they\'re off!!!'
        ];

        function getRandomPhrase() {
            const random = Math.random();
            if (random < 0.2) {
                return 'Hits are for Squares!';
            } else {
                const otherPhrases = randomPhrases.slice(1);
                return otherPhrases[Math.floor(Math.random() * otherPhrases.length)];
            }
        }

        const currentPhrase = getRandomPhrase();

        const players = {
            'M. MUNCY': { id: 571970, name: 'Max Muncy', displayName: '‚ë¨ M. MUNCY', position: '3B ‚Ä¢ National League' },
            'J. B√ÅEZ': { id: 595879, name: 'Javier B√°ez', displayName: '„âò J. B√ÅEZ', position: 'OF(!) ‚Ä¢ American League' },
            'J. ROGERS': { id: 668670, name: 'Jake Rogers', displayName: '„âû J. ROGERS', position: 'C ‚Ä¢ American League' },
            'M. BUSCH': { id: 683737, name: 'Michael Busch', displayName: '„âô M. BUSCH', position: '1B ‚Ä¢ National League' },
            'J. ADELL': { id: 666176, name: 'Jo Adell', displayName: '‚ûÜ J. ADELL', position: 'OF ‚Ä¢ American League' },
            'R. HOSKINS': { id: 656555, name: 'Rhys Hoskins', displayName: '‚ë´ R. HOSKINS', position: '1B ‚Ä¢ National League' },
            'T. WALLS': { id: 670764, name: 'Taylor Walls', displayName: '‚ûÖ T. WALLS', position: 'SS ‚Ä¢ American League' },
            'K. BRYANT': { id: 592178, name: 'Kris Bryant', displayName: '„âì K. BRYANT', position: 'OF ‚Ä¢ National League' },
            'J. SIRI': { id: 642350, name: 'Jos√© Siri', displayName: '„âí J. SIRI', position: 'OF ‚Ä¢ National League' },
            'K. LEE': { id: 686676, name: 'Korey Lee', displayName: '„âñ KOREY L.', position: 'C ‚Ä¢ American League' },
            'D. MOORE': { id: 664238, name: 'Dylan Moore', displayName: '„âï D. MOORE', position: 'UT ‚Ä¢ American League' }
        };

        let playerData = [];
        let previousPlayerStats = {};

        function checkILStatus(player) {
            let isOnIL = false;
            
            if (player.rosterEntries && player.rosterEntries.length > 0) {
                for (const entry of player.rosterEntries) {
                    const status = entry.status;
                    if (status) {
                        const statusCode = status.code || status.statusCode || '';
                        if (statusCode.includes('IL') || statusCode.includes('DL') || 
                            statusCode === 'D10' || statusCode === 'D15' || statusCode === 'D60') {
                            isOnIL = true;
                            break;
                        }
                    }
                }
            }
            
            return isOnIL;
        }

        async function fetchPlayerStats() {
            try {
                const currentYear = new Date().getFullYear();
                const playerIds = Object.values(players).map(p => p.id).join(',');
                
                const response = await fetch(`https://statsapi.mlb.com/api/v1/people?personIds=${playerIds}&hydrate=stats(group=[hitting],type=[season],season=${currentYear}),currentTeam,rosterEntries`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                const newPlayerData = data.people.map(player => {
                    const hittingStats = player.stats?.[0]?.splits?.[0]?.stat;
                    const battingAvg = hittingStats?.avg ? parseFloat(hittingStats.avg) : 0;
                    const distanceTo200 = Math.abs(battingAvg - 0.200);
                    
                    const isOnIL = checkILStatus(player);
                    const playerInfo = Object.values(players).find(p => p.id === player.id);
                    let displayName = playerInfo ? playerInfo.displayName : player.fullName;
                    
                    if (isOnIL) {
                        displayName += ' (IL)';
                    }
                    
                    const position = playerInfo ? playerInfo.position : 'Unknown';
                    
                    // Check for stat changes and events
                    const playerId = player.id;
                    const previousStats = previousPlayerStats[playerId];
                    let statChange = null;
                    let eventEmoji = '';
                    
                    if (previousStats) {
                        const previousDistance = previousStats.distanceTo200;
                        const previousHits = previousStats.hits;
                        const previousAtBats = previousStats.atBats;
                        const currentHits = hittingStats?.hits || 0;
                        const currentAtBats = hittingStats?.atBats || 0;
                        
                        // Determine if moved closer to or farther from .200
                        if (distanceTo200 < previousDistance) {
                            statChange = 'closer'; // Moved closer to .200
                        } else if (distanceTo200 > previousDistance) {
                            statChange = 'farther'; // Moved farther from .200
                        }
                        
                        // Check for events when at-bats increased (new plate appearance)
                        if (currentAtBats > previousAtBats) {
                            if (currentHits > previousHits) {
                                // Got a hit - check if it was a home run by looking at other stats
                                const currentHR = hittingStats?.homeRuns || 0;
                                const previousHR = previousStats.homeRuns || 0;
                                
                                if (currentHR > previousHR) {
                                    eventEmoji = 'üí£'; // Home run
                                } else {
                                    eventEmoji = 'üí•'; // Regular hit
                                }
                                
                                // Override stat change logic for hits based on current batting average
                                const previousAvg = previousStats.battingAverage;
                                if (previousAvg > 0.200) {
                                    // Above .200: hit moves farther from .200 (bad)
                                    statChange = 'farther';
                                } else if (previousAvg < 0.200) {
                                    // Below .200: hit moves closer to .200 (good)
                                    statChange = 'closer';
                                } else {
                                    // Exactly .200: any change is bad
                                    statChange = 'farther';
                                }
                                
                            } else {
                                // No hit gained, but at-bat increased - could be strikeout
                                // We'll check if strikeouts increased
                                const currentSO = hittingStats?.strikeOuts || 0;
                                const previousSO = previousStats.strikeOuts || 0;
                                
                                if (currentSO > previousSO) {
                                    eventEmoji = '‚ùå'; // Strikeout
                                }
                                
                                // Override stat change logic for outs based on current batting average
                                const previousAvg = previousStats.battingAverage;
                                if (previousAvg > 0.200) {
                                    // Above .200: out moves closer to .200 (good)
                                    statChange = 'closer';
                                } else if (previousAvg < 0.200) {
                                    // Below .200: out moves farther from .200 (bad)
                                    statChange = 'farther';
                                } else {
                                    // Exactly .200: any change is bad
                                    statChange = 'farther';
                                }
                            }
                        }
                    }
                    
                    // Store current stats for next comparison
                    previousPlayerStats[playerId] = {
                        battingAverage: battingAvg,
                        distanceTo200: distanceTo200,
                        atBats: hittingStats?.atBats || 0,
                        hits: hittingStats?.hits || 0,
                        homeRuns: hittingStats?.homeRuns || 0,
                        strikeOuts: hittingStats?.strikeOuts || 0
                    };
                    
                    return {
                        id: player.id,
                        name: player.fullName,
                        displayName: displayName,
                        team: player.currentTeam?.name || 'Unknown',
                        position: position,
                        battingAverage: battingAvg,
                        distanceTo200: distanceTo200,
                        atBats: hittingStats?.atBats || 0,
                        hits: hittingStats?.hits || 0,
                        isOnIL: isOnIL,
                        statChange: statChange,
                        eventEmoji: eventEmoji
                    };
                }).sort((a, b) => a.distanceTo200 - b.distanceTo200);
                
                playerData = newPlayerData;
                renderLeaderboard();
                
            } catch (error) {
                console.error('Error fetching player stats:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        ‚ö†Ô∏è Error loading player data. Please check your internet connection and try again.
                        <br><small>Error: ${error.message}</small>
                    </div>
                `;
            }
        }

        function renderLeaderboard() {
            const content = document.getElementById('content');
            const headerTimestamp = document.getElementById('headerTimestamp');
            
            const now = new Date();
            const options = { 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: true 
            };
            const formattedTime = now.toLocaleString('en-US', options).replace(' at ', ' @ ');
            
            headerTimestamp.textContent = formattedTime;
            
            if (playerData.length === 0) {
                content.innerHTML = '<div class="error">No player data available</div>';
                return;
            }
            
            const leaderboardHTML = `
                <div class="mendoza-line-divider"> "THE MENDOZA LINE" </div>
                <div class="leaderboard">
                    ${playerData.map((player, index) => {
                        let rowClass = '';
                        if (index === 0) {
                            rowClass = 'first-place';
                        } else if (index === 1) {
                            rowClass = 'second-place';
                        } else if (index === 2 || index === 4 || index === 6 || index === 8 || index === 10) {
                            rowClass = 'odd-place';
                        } else if (index === 3 || index === 5 || index === 7 || index === 9) {
                            rowClass = 'even-place';
                        }
                        
                        const belowMinimum = player.atBats < 200 ? '*' : '';
                        
                        return `
                            <div class="player-row ${rowClass} ${player.statChange === 'closer' ? 'flash-green' : ''} ${player.statChange === 'farther' ? 'flash-red' : ''}">
                                <div class="rank">${index + 1}</div>
                                <div class="player-info">
                                    <div>
                                        <div class="player-name">
                                            ${player.displayName}
                                            ${player.eventEmoji ? `<span class="event-emoji">${player.eventEmoji}</span>` : ''}
                                        </div>
                                        <div class="player-team">${player.position}</div>
                                    </div>
                                    <div class="batting-stats">
                                        <div class="batting-display">${player.battingAverage.toFixed(3).substring(1)}/${player.atBats.toString().padStart(3, '0')}${belowMinimum}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="key-and-minimum">
                    <div class="key-note">BA/ABs</div>
                    <div class="minimum-note">*Below 200 min.</div>
                </div>
                <div class="hits-squares-text">${currentPhrase}</div>
            `;
            
            content.innerHTML = leaderboardHTML;
        }

        // Initial load
        fetchPlayerStats();
        
        // Auto-refresh every 30 seconds
        setInterval(fetchPlayerStats, 30000);
        
        // Refresh on 'r' key press
        document.addEventListener('keydown', function(event) {
            if (event.key === 'r' || event.key === 'R') {
                fetchPlayerStats();
            }
        });
    </script>
</body>
</html>