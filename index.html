<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE 2025 MENDOZA STAKES</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: white;
            min-height: 100vh;
            padding: 10px;
            color: #2c2c2c;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #feed85;
            border-radius: 0px;
            border: 2px solid #feed85;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: none;
            color: black;
            line-height: 1.2;
        }
        
        .header h1 .emoji {
            font-size: 1.2rem;
        }
        
        .header p {
            font-size: 0.9rem;
            opacity: 1;
            color: black;
            line-height: 1.3;
        }
        
        .header .race-title {
            font-size: 0.9rem;
            font-weight: bold;
            font-style: italic;
            margin-bottom: 5px;
        }
        
        .info-box {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
        }
        
        .info-box p {
            font-size: 0.9rem;
            opacity: 1;
            color: #2c2c2c;
            line-height: 1.3;
        }
        
        .info-box a {
            color: #2c2c2c;
            text-decoration: underline;
        }
        
        .mendoza-line-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #2c2c2c;
            font-weight: bold;
            font-size: 1.4rem;
        }
        
        .mendoza-line-divider::before,
        .mendoza-line-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: calc(50% - 130px);
            height: 2px;
            background-color: #2c2c2c;
        }
        
        .mendoza-line-divider::before {
            left: 0;
        }
        
        .mendoza-line-divider::after {
            right: 0;
        }
        
        .last-updated {
            text-align: center;
            margin-top: 30px;
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .hits-squares-text {
            text-align: center;
            margin: 20px 0;
            font-size: 2rem;
            font-weight: bold;
            font-style: italic;
            font-family: 'Brush Script MT', cursive, 'Arial', sans-serif;
            color: #2c2c2c;
        }
        
        .copyright {
            text-align: center;
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.8;
            color: #cc99cc;
        }
        
        .copyright a {
            color: #cc99cc;
            text-decoration: underline;
        }
        
        .loading {
            text-align: center;
            font-size: 1.1rem;
            margin: 30px 0;
        }
        
        .player-row {
            display: flex;
            align-items: center;
            padding: 15px 12px;
            border-bottom: 1px solid #ddd;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .player-row.first-place {
            background: black;
            color: #feed89;
        }
        
        .player-row.second-place {
            background: #feed89;
            color: black;
        }
        
        .player-row.odd-place {
            background: black;
            color: #feed89;
        }
        
        .player-row.even-place {
            background: #feed89;
            color: black;
        }
        
        .player-row:hover {
            transform: translateX(2px);
        }
        
        .player-row:last-child {
            border-bottom: none;
        }
        
        .rank {
            font-size: 1.4rem;
            font-weight: bold;
            width: 35px;
            text-align: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .rank.closest {
            color: inherit;
            text-shadow: none;
        }
        
        .player-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 0;
        }
        
        .player-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 3px;
            line-height: 1.2;
        }
        
        .player-team {
            font-size: 0.75rem;
            opacity: 0.8;
            line-height: 1.2;
        }
        
        .batting-stats {
            text-align: right;
            flex-shrink: 0;
        }
        
        .batting-display {
            font-size: 1.4rem;
            font-weight: bold;
            line-height: 1.2;
        }
        
        .minimum-note {
            text-align: right;
            margin-top: 15px;
            font-size: 0.8rem;
            color: black;
            font-style: normal;
            margin-right: 12px;
        }
        
        .error {
            text-align: center;
            color: black;
            font-size: 1rem;
            margin: 30px 0;
            padding: 15px;
            background: #feed85;
            border-radius: 0px;
            border: 1px solid #feed89;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loading {
            animation: pulse 2s infinite;
        }
        
        .at-bats-text {
            font-size: 0.7rem;
            margin-top: 3px;
            opacity: 0.7;
            line-height: 1.2;
        }
        
        .plate-appearance-alert {
            display: inline-block;
            font-size: 1rem;
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .flash-red {
            animation: flashRed 2s ease-out;
        }
        
        .flash-green {
            animation: flashGreen 2s ease-out;
        }
        
        @keyframes flashRed {
            0% { background-color: inherit; }
            20% { background-color: #ff4444; }
            100% { background-color: inherit; }
        }
        
        @keyframes flashGreen {
            0% { background-color: inherit; }
            20% { background-color: #44ff44; }
            100% { background-color: inherit; }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .header p {
                font-size: 0.85rem;
            }
            
            .header .race-title {
                font-size: 0.85rem;
            }
            
            .mendoza-line-divider {
                font-size: 1.2rem;
            }
            
            .mendoza-line-divider::before,
            .mendoza-line-divider::after {
                width: calc(50% - 110px);
            }
            
            .hits-squares-text {
                font-size: 1.8rem;
            }
            
            .player-row {
                padding: 12px 10px;
            }
            
            .rank {
                font-size: 1.2rem;
                width: 30px;
                margin-right: 10px;
            }
            
            .player-name {
                font-size: 1rem;
            }
            
            .player-team {
                font-size: 0.7rem;
            }
            
            .batting-display {
                font-size: 1.2rem;
            }
            
            .at-bats-text {
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><strong><span class="emoji">üèá‚öæüí∏</span> THE 2025 <span class="emoji">üèá‚öæüí∏</span><br>MENDOZA STAKES</strong></h1>
            <p class="race-title"><strong><em>2nd Annual Bob Uecker Memorial Race to .200</em></strong></p>
            <p><strong>LIVE</strong> standings updated: <span id="headerTimestamp">Loading...</span></p>
        </div>
        
        <div id="content">
            <div class="loading">Loading player data...</div>
        </div>
        
        <div class="info-box">
            <p>For more information about The Mendoza League,<br>please contact <a href="mailto:commish@mendozaleague.com?subject=Your ideas are intriguing to me, and I wish to subscribe to your newsletter.">your loyal Commissioner</a>.</p>
        </div>
        <div class="copyright">¬©2025 your pal <a href="https://www.dudlawson.com" target="_blank">Dud Lawson</a></div>
    </div>

    <script>
        // Random phrases array with "Hits are for squares!" having 20% probability
        const randomPhrases = [
            'Hits are for squares!',
            'Stakes is Mid',
            'As Above | So Below',
            'Your Perfect Fantasy',
            'This is My Fantasy',
            'Best we can do is our Worst',
            'Not so Good ain\'t so Bad',
            'Not so Bad ain\'t so Good',
            '‚ë™ M. Mendoza .215/1,337',
            '‚ë® B. Uecker .200/731',
            '...It\'s a Shame!',
            'It\'s Good to be Okay',
            'Someone hire Tony Rizzo',
            'Greetings from the Middle West',
            'Shoutout to Josep Oller',
            'Happy International Bookie Appreciation Day',
            'Manny Ramirez hit .170 his rookie year',
            'So it goes!',
            'Batting & Nothingness',
            'Root for Nothing!',
            'Out, out, damn\'ed shortstop!',
            '& They say a Compruter can do My Job better than I can damn do it!'
        ];

        // Function to get random phrase with 20% chance for "Hits are for Squares!"
        function getRandomPhrase() {
            const random = Math.random();
            if (random < 0.2) {
                return 'Hits are for Squares!';
            } else {
                // Pick from the other phrases (excluding the first one which is "Hits are for Squares!")
                const otherPhrases = randomPhrases.slice(1);
                return otherPhrases[Math.floor(Math.random() * otherPhrases.length)];
            }
        }

        // Set the random phrase once when the page loads
        const currentPhrase = getRandomPhrase();

        // Player mapping with their MLB API player IDs and jersey numbers
        const players = {
            'M. MUNCY': { id: 571970, name: 'Max Muncy', displayName: '‚ë¨ M. MUNCY', position: '3B ‚Ä¢ National League' },
            'J. B√ÅEZ': { id: 595879, name: 'Javier B√°ez', displayName: '„âò J. B√ÅEZ', position: 'OF(!) ‚Ä¢ American League' },
            'J. ROGERS': { id: 668670, name: 'Jake Rogers', displayName: '„âû J. ROGERS', position: 'C ‚Ä¢ American League' },
            'M. BUSCH': { id: 683737, name: 'Michael Busch', displayName: '„âô M. BUSCH', position: '1B ‚Ä¢ National League' },
            'J. ADELL': { id: 666176, name: 'Jo Adell', displayName: '‚ûÜ J. ADELL', position: 'OF ‚Ä¢ American League' },
            'R. HOSKINS': { id: 656555, name: 'Rhys Hoskins', displayName: '‚ë´ R. HOSKINS', position: '1B ‚Ä¢ National League' },
            'T. WALLS': { id: 670764, name: 'Taylor Walls', displayName: '‚ûÖ T. WALLS', position: 'SS ‚Ä¢ American League' },
            'K. BRYANT': { id: 592178, name: 'Kris Bryant', displayName: '„âì K. BRYANT', position: 'OF ‚Ä¢ National League' },
            'J. SIRI': { id: 642350, name: 'Jos√© Siri', displayName: '„âí J. SIRI', position: 'OF ‚Ä¢ National League' },
            'K. LEE': { id: 686676, name: 'Korey Lee', displayName: '„âñ K. LEE', position: 'C ‚Ä¢ American League' },
            'D. MOORE': { id: 664238, name: 'Dylan Moore', displayName: '„âï D. MOORE', position: 'UT ‚Ä¢ American League' }
        };

        let playerData = [];
        let previousPlayerStats = {}; // Store previous stats to detect changes

        async function fetchPlayerStats() {
            try {
                const currentYear = new Date().getFullYear();
                const playerIds = Object.values(players).map(p => p.id).join(',');
                
                // MLB Stats API endpoint for current season stats with roster status and live game data
                const response = await fetch(`https://statsapi.mlb.com/api/v1/people?personIds=${playerIds}&hydrate=stats(group=[hitting],type=[season],season=${currentYear}),currentTeam,rosterEntries`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check for live games and plate appearances
                let liveGameData = {};
                try {
                    const liveResponse = await fetch('https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=' + new Date().toISOString().split('T')[0] + '&hydrate=linescore,game(content(media(featured))),decisions');
                    if (liveResponse.ok) {
                        const liveData = await liveResponse.json();
                        // Check each game for our players
                        for (const date of liveData.dates) {
                            for (const game of date.games) {
                                if (game.status.statusCode === 'I') { // In progress
                                    try {
                                        const gameResponse = await fetch(`https://statsapi.mlb.com/api/v1/game/${game.gamePk}/playByPlay`);
                                        if (gameResponse.ok) {
                                            const gameData = await gameResponse.json();
                                            // Check if any of our players are currently batting
                                            if (gameData.liveData && gameData.liveData.plays && gameData.liveData.plays.currentPlay) {
                                                const currentPlay = gameData.liveData.plays.currentPlay;
                                                if (currentPlay.matchup && currentPlay.matchup.batter) {
                                                    const batterId = currentPlay.matchup.batter.id;
                                                    if (Object.values(players).some(p => p.id === batterId)) {
                                                        liveGameData[batterId] = { inPlateAppearance: true };
                                                    }
                                                }
                                            }
                                        }
                                    } catch (e) {
                                        // Ignore individual game fetch errors
                                    }
                                }
                            }
                        }
                    }
                } catch (e) {
                    // Ignore live game fetch errors
                }
                
                const newPlayerData = data.people.map(player => {
                    const hittingStats = player.stats?.[0]?.splits?.[0]?.stat;
                    const battingAvg = hittingStats?.avg ? parseFloat(hittingStats.avg) : 0;
                    const distanceTo200 = Math.abs(battingAvg - 0.200);
                    
                    // Check if player is on IL by looking at roster entries
                    let isOnIL = false;
                    if (player.rosterEntries && player.rosterEntries.length > 0) {
                        for (const entry of player.rosterEntries) {
                            const rosterStatus = entry.status?.code;
                            if (rosterStatus && (
                                rosterStatus.includes('IL') || 
                                rosterStatus === 'IL10' || 
                                rosterStatus === 'IL15' || 
                                rosterStatus === 'IL60' ||
                                rosterStatus === 'DL10' ||
                                rosterStatus === 'DL15' ||
                                rosterStatus === 'DL60'
                            )) {
                                isOnIL = true;
                                break;
                            }
                        }
                    }
                    
                    // Find the display name with jersey number and position
                    const playerInfo = Object.values(players).find(p => p.id === player.id);
                    let displayName = playerInfo ? playerInfo.displayName : player.fullName;
                    
                    // Add (IL) if player is on injured list
                    if (isOnIL) {
                        displayName += ' (IL)';
                    }
                    
                    const position = playerInfo ? playerInfo.position : 'Unknown';
                    
                    // Check for stat changes
                    const playerId = player.id;
                    const previousStats = previousPlayerStats[playerId];
                    let statChange = null;
                    
                    if (previousStats) {
                        const previousDistance = previousStats.distanceTo200;
                        if (distanceTo200 < previousDistance) {
                            statChange = 'closer'; // Moved closer to .200
                        } else if (distanceTo200 > previousDistance) {
                            statChange = 'farther'; // Moved farther from .200
                        }
                    }
                    
                    // Store current stats for next comparison
                    previousPlayerStats[playerId] = {
                        battingAverage: battingAvg,
                        distanceTo200: distanceTo200,
                        atBats: hittingStats?.atBats || 0,
                        hits: hittingStats?.hits || 0
                    };
                    
                    return {
                        id: player.id,
                        name: player.fullName,
                        displayName: displayName,
                        team: player.currentTeam?.name || 'Unknown',
                        position: position,
                        battingAverage: battingAvg,
                        distanceTo200: distanceTo200,
                        atBats: hittingStats?.atBats || 0,
                        hits: hittingStats?.hits || 0,
                        isOnIL: isOnIL,
                        inPlateAppearance: liveGameData[player.id]?.inPlateAppearance || false,
                        statChange: statChange
                    };
                }).sort((a, b) => a.distanceTo200 - b.distanceTo200);
                
                playerData = newPlayerData;
                renderLeaderboard();
                
            } catch (error) {
                console.error('Error fetching player stats:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        ‚ö†Ô∏è Error loading player data. Please check your internet connection and try again.
                        <br><small>Error: ${error.message}</small>
                    </div>
                `;
            }
        }

        function renderLeaderboard() {
            const content = document.getElementById('content');
            const headerTimestamp = document.getElementById('headerTimestamp');
            
            // Update timestamp in header
            const now = new Date();
            const options = { 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: true 
            };
            const formattedTime = now.toLocaleString('en-US', options).replace(' at ', ' @ ');
            
            headerTimestamp.textContent = formattedTime;
            
            if (playerData.length === 0) {
                content.innerHTML = '<div class="error">No player data available</div>';
                return;
            }
            
            // Get the phrase that was set when page loaded
            const randomPhrase = currentPhrase;
            
            const leaderboardHTML = `
                <div class="mendoza-line-divider"> "THE MENDOZA LINE" </div>
                <div class="leaderboard">
                    ${playerData.map((player, index) => {
                        const maxDistance = Math.max(...playerData.map(p => p.distanceTo200));
                        const fillWidth = maxDistance > 0 ? (player.distanceTo200 / maxDistance) * 100 : 0;
                        
                        // Determine row class based on position
                        let rowClass = '';
                        if (index === 0) {
                            rowClass = 'first-place';
                        } else if (index === 1) {
                            rowClass = 'second-place';
                        } else if (index === 2 || index === 4 || index === 6 || index === 8 || index === 10) {
                            // 3rd, 5th, 7th, 9th, 11th places (0-indexed: 2, 4, 6, 8, 10)
                            rowClass = 'odd-place';
                        } else if (index === 3 || index === 5 || index === 7 || index === 9) {
                            // 4th, 6th, 8th, 10th places (0-indexed: 3, 5, 7, 9)
                            rowClass = 'even-place';
                        }
                        
                        // Determine if this is an even place (yellow background) for styling
                        const isEvenPlace = (index === 1 || index === 3 || index === 5 || index === 7 || index === 9);
                        
                        // Check if below 200 at-bats
                        const belowMinimum = player.atBats < 200 ? '*' : '';
                        
                        return `
                            <div class="player-row ${rowClass} ${player.statChange === 'closer' ? 'flash-green' : ''} ${player.statChange === 'farther' ? 'flash-red' : ''}" id="player-${player.id}">
                                <div class="rank ${index === 0 ? 'closest' : ''}">${index + 1}</div>
                                <div class="player-info">
                                    <div>
                                        <div class="player-name">
                                            ${player.displayName}
                                            ${player.inPlateAppearance ? '<span class="plate-appearance-alert">üö®</span>' : ''}
                                        </div>
                                        <div class="player-team">${player.position}</div>
                                    </div>
                                    <div class="batting-stats">
                                        <div class="batting-display">${player.battingAverage.toFixed(3).substring(1)}/${player.atBats.toString().padStart(3, '0')}${belowMinimum}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="minimum-note">*Below 200 At Bat minimum</div>
                <div class="hits-squares-text">${randomPhrase}</div>
            `;
            
            content.innerHTML = leaderboardHTML;
        }

        // Initial load
        fetchPlayerStats();
        
        // Auto-refresh every 30 seconds
        setInterval(fetchPlayerStats, 30000);
        
        // Add a manual refresh button (optional)
        document.addEventListener('keydown', function(event) {
            if (event.key === 'r' || event.key === 'R') {
                fetchPlayerStats();
            }
        });
    </script>
</body>
</html>