<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE 2026 MENDOZA STAKES</title>
    <meta name="description" content="The 3rd Annual Running of the Bob Uecker Memorial Race to .200 - Live MLB batting average tracking">
    <meta name="author" content="Dud Lawson">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { overflow-y: scroll; overflow-x: hidden; height: 100%; -webkit-overflow-scrolling: touch; }
        body { font-family: 'Arial', sans-serif; background: #b8ddf2; min-height: 100%; padding: 10px; padding-bottom: 30px; color: #2c2c2c; overflow-x: hidden; overflow-y: auto; position: relative; }
        @keyframes wave { 0%, 9%, 100% { transform: translateY(0); } 4.5% { transform: translateY(-10px); } }
        @keyframes wave-diamond { 0%, 9%, 100% { transform: translateY(0) rotate(45deg); } 4.5% { transform: translateY(-10px) rotate(45deg); } }
        .wave-emoji-1 { animation: wave 11s ease-in-out 10s infinite; }
        .wave-emoji-2 { animation: wave 11s ease-in-out 10.15s infinite; }
        .wave-emoji-3 { animation: wave 11s ease-in-out 10.3s infinite; }
        .wave-emoji-4 { animation: wave 11s ease-in-out 10.45s infinite; }
        .wave-emoji-5 { animation: wave 11s ease-in-out 10.6s infinite; }
        .wave-emoji-6 { animation: wave 11s ease-in-out 10.75s infinite; }
        .wave-emoji-1, .wave-emoji-2, .wave-emoji-3, .wave-emoji-4, .wave-emoji-5, .wave-emoji-6 { display: inline-block; }
        .live-letter { display: inline-block; }
        .live-letter.wave-emoji-1 { animation: wave 11s ease-in-out 10s infinite; }
        .live-letter.wave-emoji-2 { animation: wave 11s ease-in-out 10.15s infinite; }
        .live-letter.wave-emoji-3 { animation: wave 11s ease-in-out 10.3s infinite; }
        .live-letter.wave-emoji-4 { animation: wave 11s ease-in-out 10.45s infinite; }
        .live-letter.paused { animation-play-state: paused !important; }
        .container { max-width: 100%; margin: 0 auto; padding-bottom: 20px; }
        .header { text-align: center; margin-bottom: 0; padding: 15px; background: #b8ddf2; border: 2px solid #b8ddf2; }
        .header h1 { font-size: 2.0rem; margin-bottom: 0; color: black; line-height: 1.2; }
        .header-diamond { display: inline-block; width: 1.2rem; height: 1.2rem; background-color: black; transform: rotate(45deg); margin: 0 0.4rem; vertical-align: middle; }
        .header-diamond.wave-emoji-1 { animation: wave-diamond 11s ease-in-out 10s infinite; }
        .header-diamond.wave-emoji-2 { animation: wave-diamond 11s ease-in-out 10.15s infinite; }
        .header-diamond.wave-emoji-3 { animation: wave-diamond 11s ease-in-out 10.3s infinite; }
        .header-diamond.wave-emoji-4 { animation: wave-diamond 11s ease-in-out 10.45s infinite; }
        .header-diamond.wave-emoji-5 { animation: wave-diamond 11s ease-in-out 10.6s infinite; }
        .header-diamond.wave-emoji-6 { animation: wave-diamond 11s ease-in-out 10.75s infinite; }
        .header .race-title { font-size: 0.95rem; color: #b8ddf2; line-height: 1; font-weight: normal; font-style: normal; margin: 0; padding: 0; white-space: nowrap; display: flex; align-items: center; }
        .hexagon-bar { position: relative; background: black; padding: 0 12px; margin: 8px auto 0; display: inline-flex; align-items: center; justify-content: center; height: 1.5rem; width: auto; box-sizing: border-box; max-width: fit-content; }
        .live-standings { text-align: center; margin-bottom: 20px; font-size: 0.9rem; color: #2c2c2c; }
        .live-standings a { color: #2c2c2c; text-decoration: underline; cursor: pointer; }
        .mendoza-line-divider { text-align: center; margin: -15px 0 0 0; padding: 15px 12px; position: relative; color: #2c2c2c; font-weight: bold; font-size: 1.4rem; display: flex; align-items: center; justify-content: center; }
        .mendoza-line-divider::before, .mendoza-line-divider::after { content: ''; position: absolute; top: 50%; width: calc(50% - 140px); height: 2px; background-color: #2c2c2c; }
        .mendoza-line-divider::before { left: 0; }
        .mendoza-line-divider::after { right: 0; }
        .hits-squares-text { text-align: center; margin: 20px 0; font-size: 1.8rem; font-weight: normal; font-style: normal; font-family: 'Brush Script MT', cursive, 'Arial', sans-serif; color: #2c2c2c; line-height: 1.3; min-height: 2.6rem; display: flex; align-items: center; justify-content: center; }
        .copyright { text-align: center; margin-top: 15px; font-size: 0.8rem; opacity: 0.8; color: #cc99cc; }
        .copyright a { color: #cc99cc; text-decoration: underline; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .modal.open { display: block; }
        .modal-content { background-color: #b8ddf2; margin: 20px auto; padding: 20px; width: 80%; max-width: 500px; position: relative; max-height: calc(100vh - 40px); overflow-y: auto; }
        .close { color: #2c2c2c; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; line-height: 20px; cursor: pointer; z-index: 10; }
        .close:hover, .close:focus { color: #000; }
        .rules-symbol-bottom { text-align: center; color: #2c2c2c; margin-top: 15px; font-size: 1rem; letter-spacing: -0.25rem; }
        .rules-divider { text-align: center; margin: 20px 0; color: #b8ddf2; background: black; font-weight: bold; font-size: 1rem; padding: 10px; }
        .modal-content p { color: #2c2c2c; line-height: 1.5; margin-bottom: 12px; text-align: center; font-size: 0.95rem; }
        .player-row { display: flex; align-items: center; padding: 15px 12px; position: relative; }
        .player-row.first-place { background: black; color: #b8ddf2; }
        .player-row.second-place { background: #b8ddf2; color: black; }
        .player-row.odd-place { background: black; color: #b8ddf2; }
        .player-row.even-place { background: #b8ddf2; color: black; }
        .player-row:last-child { border-bottom: none; }
        .player-info { flex: 1; display: flex; justify-content: space-between; align-items: center; min-width: 0; width: 100%; }
        .player-name { font-size: 1.5rem; font-weight: bold; line-height: 1.2; position: relative; padding-left: 0; cursor: pointer; display: flex; align-items: center; }
        .player-name.tbd-line .tbd-text { display: none; }
        .player-name.tbd-line::after { content: ''; display: inline-block; width: 11ch; height: 2px; background-color: currentColor; vertical-align: middle; }
        .batting-stats { text-align: right; flex-shrink: 0; position: relative; min-width: 0; }
        .batting-display { font-size: 1.5rem; font-weight: bold; line-height: 1.2; cursor: pointer; position: relative; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; text-align: right; }
        .batting-average { position: relative; z-index: 1; text-align: right; }
        .tap-tooltip { position: absolute; top: 0; right: 0; padding: 0; font-size: 1.5rem; font-weight: bold; z-index: 2; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; pointer-events: none; text-align: right; white-space: nowrap; height: 100%; display: flex; align-items: center; justify-content: flex-end; border-radius: 4px; width: 100%; }
        .player-row.first-place .tap-tooltip, .player-row.odd-place .tap-tooltip { color: #b8ddf2; background-color: black; }
        .player-row.second-place .tap-tooltip, .player-row.even-place .tap-tooltip { color: black; background-color: #b8ddf2; }
        .batting-display:hover .tap-tooltip, .batting-display.active .tap-tooltip { opacity: 1; visibility: visible; }
        .player-modal-content { background-color: #b8ddf2; margin: 20px auto; padding: 30px 20px; width: 80%; max-width: 500px; position: relative; max-height: calc(100vh - 40px); overflow-y: auto; }
        .player-modal-header { text-align: center; margin-bottom: 20px; margin-top: 20px; position: relative; }
        .player-modal-header h2 { font-size: 2rem; color: #b8ddf2; background: black; margin-bottom: 10px; padding: 10px 60px 10px 60px; font-weight: bold; transition: opacity 0.2s; display: block; text-align: center; word-wrap: break-word; overflow-wrap: break-word; }
        .player-modal-header .player-number { background-color: #b8ddf2; color: black; font-size: 1rem; width: 1.5rem; height: 1.5rem; position: absolute; left: 10px; top: 50%; transform: translateY(-50%) rotate(45deg); margin-right: 0; z-index: 10; }
        .player-modal-header .player-position { background-color: #b8ddf2; color: black; font-size: 0.8rem; font-weight: bold; width: 1.5rem; height: 1.5rem; position: absolute; right: 10px; top: 50%; transform: translateY(-50%) rotate(45deg); margin-right: 0; z-index: 10; display: flex; align-items: center; justify-content: center; }
        .player-modal-header .player-position span { transform: rotate(-45deg); }
        .player-modal-header h2:hover { opacity: 0.8; }
        .player-modal-stats-container { display: flex; align-items: center; justify-content: center; margin-bottom: 15px; position: relative; }
        .player-status-indicator { text-align: center; font-size: 0.75rem; color: #2c2c2c; font-weight: bold; line-height: 1.3; }
        .player-trend-indicator { text-align: center; font-size: 0.75rem; color: #2c2c2c; font-weight: bold; line-height: 1.3; }
        .player-modal-stats { flex: 1; text-align: center; color: #2c2c2c; padding: 0 20px; }
        .player-modal-stats p { font-size: 1rem; margin-bottom: 8px; line-height: 1.4; }
        .player-modal-stats strong { font-weight: bold; }
        .screw-flanders { text-align: center; font-size: 1rem; line-height: 1.6; color: #2c2c2c; word-wrap: break-word; margin-top: 20px; margin-bottom: 15px; }
        .bio-symbol { color: #b8ddf2; margin-top: 15px; font-size: 0.75rem; font-weight: bold; background-color: black; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; }
        .bio-close-btn { text-align: center; margin-top: 20px; font-size: 0.75rem; font-weight: bold; cursor: pointer; color: #b8ddf2; background-color: black; padding: 8px 16px; display: inline-block; }
        .bio-close-btn:hover { opacity: 0.7; }
        #horse-animation { 
            font-size: 0.7rem; 
            line-height: 1.1; 
            white-space: pre; 
            overflow-x: auto; 
            max-width: 100%; 
            color: #2c2c2c;
        }
        .player-number { display: inline-flex; align-items: center; justify-content: center; width: 1.2rem; height: 1.2rem; font-size: 0.8rem; font-weight: bold; margin-right: 1rem; flex-shrink: 0; transform: rotate(45deg); }
        .player-number span { display: block; transform: rotate(-45deg); }
        .player-row.first-place .player-number, .player-row.odd-place .player-number { background-color: #b8ddf2; color: black; }
        .player-row.second-place .player-number, .player-row.even-place .player-number { background-color: black; color: #b8ddf2; }
        .contact-modal-content { background-color: #b8ddf2; margin: 20px auto; padding: 30px 20px; width: 80%; max-width: 500px; position: relative; max-height: calc(100vh - 40px); overflow-y: auto; }
        .contact-modal-header { text-align: center; margin-bottom: 20px; }
        .contact-modal-header h2 { font-size: 1.5rem; color: #2c2c2c; margin-bottom: 20px; font-weight: bold; }
        .contact-form-group { margin-bottom: 20px; }
        .contact-form-group label { display: block; color: #2c2c2c; font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; }
        .contact-form-group input, .contact-form-group textarea { width: 100%; padding: 10px; border: none; background: white; color: #2c2c2c; font-family: 'Arial', sans-serif; font-size: 0.95rem; border-radius: 0; outline: none; }
        .contact-form-group input:focus, .contact-form-group textarea:focus { border: 2px solid black; padding: 8px; }
        .contact-form-group textarea { min-height: 150px; resize: vertical; }
        .contact-form-group input::placeholder, .contact-form-group textarea::placeholder { color: #555; opacity: 0.7; }
        .contact-submit-btn { background: black; color: #b8ddf2; border: none; padding: 12px 30px; font-size: 1rem; font-weight: bold; cursor: pointer; width: 100%; transition: opacity 0.2s; }
        .contact-submit-btn:hover { opacity: 0.8; }
        @media (max-width: 768px) {
            body { padding: 8px; padding-bottom: 30px; }
            .modal-content { width: 90%; margin: 10px auto; padding: 20px; max-height: calc(100vh - 20px); }
            .player-modal-content { width: 90%; padding: 25px 15px; }
            .player-modal-header h2 { font-size: 1.5rem; }
            .player-modal-stats p { font-size: 0.9rem; }
            .screw-flanders { font-size: 0.9rem; }
            .rules-divider { font-size: 1rem; }
            .header h1 { font-size: 1.75rem; }
            .header-diamond { width: 1.05rem; height: 1.05rem; margin: 0 0.35rem; }
            .header p { font-size: 0.85rem; }
            .mendoza-line-divider { font-size: 1.2rem; }
            .mendoza-line-divider::before, .mendoza-line-divider::after { width: calc(50% - 110px); }
            .hits-squares-text { font-size: 1.8rem; min-height: 2.3rem; font-style: normal; font-weight: normal; }
            .player-row { padding: 12px 10px; }
            .player-name { font-size: 1.25rem; }
            .batting-display { font-size: 1.25rem; }
            .tap-tooltip { font-size: 1.25rem; padding: 0; }
            #horse-animation { 
                font-size: 0.5rem; 
                line-height: 1.0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><strong><span class="header-diamond wave-emoji-1"></span><span class="header-diamond wave-emoji-2"></span><span class="header-diamond wave-emoji-3"></span> 2026 <span class="header-diamond wave-emoji-4"></span><span class="header-diamond wave-emoji-5"></span><span class="header-diamond wave-emoji-6"></span><br>MENDOZA STAKES</strong></h1>
            <div class="hexagon-bar">
                <p class="race-title"><i>Hits are for Squares</i>‚¨©<i>Since 2015</i></p>
            </div>
        </div>
        <div class="mendoza-line-divider">"THE MENDOZA LINE"</div>
        <div id="standings-container">
            <!-- Player rows will be dynamically inserted here -->
        </div>
        <div style="text-align: center; margin: 15px 0;">
            <div class="hits-squares-text">Next Race: Mar 25 ‚Äì Sept 27</div>
        </div>
        <div class="live-standings">
            <p><strong id="live-indicator"><span id="countdown-timer">00:00:00:00</span> UNTIL POST TIME</strong><br>View our 2026 Race <a id="rules-trigger"><strong>PARAMETERS</strong></a><br><a id="contact-trigger"><strong><u>CONTACT</u></strong></a> your loyal Commissioner<br>Watch Race <a href="#" id="bugle-trigger" style="cursor: pointer;"><strong><u>SIMULATION</u></strong></a></p>
        </div>
        <div class="copyright">
            mendozaleague.com ver3.2 ¬©2026‚¨©<span id="live-text"><span class="live-letter wave-emoji-1">L</span><span class="live-letter wave-emoji-2">I</span><span class="live-letter wave-emoji-3">V</span><span class="live-letter wave-emoji-4">E</span></span> updates every 0:11
        </div>
    </div>
    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="rules">&times;</span>
            <h1 style="font-size: 2.0rem; margin: 15px 0 20px 0; color: black; font-weight: bold; text-align: center;"><strong>PARAMETERS</strong></h1>
            <div class="rules-divider">WAGERING</div>
            <p><strong>Pre-Race Tickets: $25</strong><br><span style="font-size: 0.85rem;">Available during Spring Training</span></p>
            <p><strong>Mid-Race Tickets: $45</strong><br><span style="font-size: 0.85rem;">Available during All-Star Break</span></p>
            <div class="rules-divider">ENTRY/FEES</div>
            <p>Please send picks & payments to<br>your loyal <a href="/cdn-cgi/l/email-protection#e2818d8f8f8b918aa28f878c868d98838e8783859787cc818d8fdd91978088878196dfa58b9487c7d0d28f87c7d0d2bdbdc7d0d2968b8189879691c7d0d2848d90c7d0d2bdbdbdbdbdbdbdbdbdbdbdcec7d0d2a18d8f8f8b918ac3" style="color: #2c2c2c; text-decoration: underline; font-weight: bold;">Commissioner</a> via <strong>VENMO</strong><br>before Monday, May 25, 2026</p>
            <div class="rules-divider">PAYOUTS</div>
            <p><strong>ALL-STAR BREAK: July 10, 2026</strong></p>
            <p style="font-size: 0.8rem;">20% of purse split between ticket holders<br>of FIRST batter to reach 200 At Bats</p>
            <p><strong>FINISH LINE: September 27, 2026</strong></p>
            <p style="font-size: 0.8rem;">Remaining purse + all Mid-Race ticket funds<br>split between ticket holders of eligible batter<br>(MIN 200 AB) closest* to The Mendoza Line</p>
            <p style="font-size: 0.8rem; font-style: italic; margin-top: 20px;">*Above or below a .200 Batting Average</p>
            <div style="text-align: center; margin-top: 20px;">
                <div class="bio-close-btn" onclick="document.getElementById('rules-modal').classList.remove('open'); document.body.style.overflow='';">CLOSE</div>
            </div>
        </div>
    </div>
    <div id="player-modal" class="modal">
        <div class="player-modal-content">
            <span class="close" data-modal="player">&times;</span>
            <div class="player-modal-header">
                <span id="player-modal-number"></span>
                <span id="player-modal-position"></span>
                <h2 id="player-modal-name"></h2>
            </div>
            <div class="player-modal-stats-container">
                <div class="player-modal-stats">
                    <p id="player-modal-details"></p>
                    <p id="player-modal-2025-stats"></p>
                    <p id="player-modal-2026-stats"></p>
                    <p id="player-modal-current-stats"><strong>Current Stats: ---/---AB</strong></p>
                    <p id="player-modal-games" style="font-size: 0.9rem; margin-top: 5px; margin-bottom: 8px;"></p>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding: 0 20px;">
                <div class="player-status-indicator" style="position: static; transform: none;">
                    <div style="font-size: 0.65rem;">STATUS:</div>
                    <div id="player-status" style="font-size: 0.65rem;">WINTER</div>
                </div>
                <div id="player-team-designation" style="font-family: 'Brush Script MT', cursive, 'Arial', sans-serif; font-size: 1.25rem; text-align: center; color: #2c2c2c; font-style: italic; padding: 0 10px; flex: 1; line-height: 1.4; white-space: nowrap;"></div>
                <div class="player-trend-indicator" style="position: static; transform: none;">
                    <div style="font-size: 0.65rem;">TREND:</div>
                    <div id="player-trend" style="font-size: 0.65rem;">---</div>
                </div>
            </div>
            <div style="width: 100%; height: 6px; background-color: #2c2c2c; margin-bottom: 15px;"></div>
            <div class="screw-flanders" id="player-modal-screw"></div>
            <div style="text-align: center;">
                <div class="bio-close-btn" onclick="closeModalWithScroll(document.getElementById('player-modal'));">CLOSE</div>
            </div>
        </div>
    </div>
    <div id="contact-modal" class="modal">
        <div class="contact-modal-content">
            <span class="close" data-modal="contact">&times;</span>
            <div class="contact-modal-header">
                <h2>CONTACT YOUR LOYAL COMMISSIONER</h2>
            </div>
            <form id="contact-form" action="https://formspree.io/f/xnjpgbpj" method="POST">
                <div class="contact-form-group">
                    <label for="contact-email">YOUR EMAIL:</label>
                    <input type="email" id="contact-email" name="email" required>
                </div>
                <div class="contact-form-group">
                    <label for="contact-message">YOUR MESSAGE:</label>
                    <textarea id="contact-message" name="message" placeholder="Qu√© tal, Commish??" required></textarea>
                </div>
                <button type="submit" class="contact-submit-btn">SEND MESSAGE</button>
            </form>
        </div>
    </div>
    <div id="horse-modal" class="modal">
        <div class="modal-content" style="background-color: black; max-width: 90%; width: 1200px; height: 500px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
            <div style="flex: 1; display: flex; justify-content: center; align-items: center; overflow: hidden;">
                <pre id="horse-animation" style="font-family: monospace; font-size: 0.65rem; line-height: 1.1; color: #b8ddf2; text-align: left; white-space: pre;"></pre>
            </div>
            <div id="horse-text" style="font-family: monospace; font-size: 0.65rem; line-height: 1.1; color: #b8ddf2; text-align: center; margin-top: 10px; white-space: pre; visibility: hidden; min-height: 1.1rem;">Look @ 'em go!!</div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
const playerData={
    1:{name:"P.C.A.",number:"4",position:"OF",fullName:"Pete Crow-Armstrong",wbcFlag:"üá∫üá∏",mlbId:691718,age:23,height:"6'0\"",weight:"184lbs",battingAvg2025:".247/591AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/players/c/crowape01.shtml",bio:"<i>Technically</i> their mascot is a pantsless bear named Clark, but the <i>real</i> face of the Cubs is Pete Crow-Armstrong. & boy has Chicago's National League ballclub been trotting him around town! On the sideline with the Bears‚Ä¶ behind the glass at Blackhawks games with the Bears quarterback‚Ä¶ even working out in purple with Chicago's Big Ten Team. It makes sense that Pete's become THE North Side fan favorite after his All Star season in 2025. He absolutely racked up At Bats, hit a Khris Davis-approved .247 & smacked 31 home runs‚Ä¶ but only 7 of those came in the second half. Yikes! Will P.C.A. be refreshed for 2026 or was the end of last season the beginning of a disappointing denouement?"},
    2:{name:"M. MURAKAMI",number:"5",position:"DH",fullName:"Munetaka Murakami",wbcFlag:"üáØüáµ",mlbId:null,age:25,height:"6'2\"",weight:"213lbs",battingAvg2025:"*",battingAvgValue:".273/187AB",games:"",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/register/player.fcgi?id=muraka000mun",bio:"One of the biggest bats in Japanese baseball history is bringing his talent (& 30% strikeout rate) to the south side of Chicago! Murakami hit a Nippon Professional Baseball record 56 h≈çmurans in 2022. He most recently missed about half of last season with an oblique injury, but still hit .273 with 187 At Bats *in 56 games. That was against Japanese pitching, though‚Ä¶ & the only MLB front office willing to take the risk was none other than Chicago's American League ballclub. Never change, Jerry!!"},
    3:{name:"M. MUNCY",number:"10",position:"IF",fullName:"Max Muncy (AL)",wbcFlag:null,mlbId:null,age:23,height:"6'1\"",weight:"180lbs",battingAvg2025:".214/206AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/register/player.fcgi?id=muncy-002max",bio:"In 2025, Max Muncy finished his rookie season 14 points above The Mendoza Line in 206 At Bats. Let's be clear THIS Max Muncy is NOT the Max Muncy who competed in last year's Mendoza Stakes. THAT Max Muncy is a 10-year veteran infielder for the Los Angeles National League ballclub. THIS Max Muncy is a SOPHOMORE infielder for what is currently the SACRAMENTO American League ballclub. The wildest part is you can't even say THIS Max Muncy is \"the one born on August 25\" because BOTH Maxes Muncy were born on August 25th. How about that!"},
    4:{name:"B. NAYLOR",number:"14",position:"C",fullName:"Noah-Gibson \"Bo\" Naylor",wbcFlag:null,mlbId:647304,age:25,height:"6'0\"",weight:"205lbs",battingAvg2025:".195/359AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/players/n/naylobo01.shtml",bio:"If Noah-Gibson Naylor, better known as Bo, sounds vaguely familiar it's probably because his older brother Josh plays for the Mariners. Bo only hit .195 last season, yet still seems to be Cleveland's guy behind the plate in the foreseeable future. At the time of this writing, the other two catchers on their roster are David Fry (.171/146AB) and journeyman Austin Hedges (.161/155) so it seems like his job is safe? You can only go up from here, Bo! Unless you go down, of course. That's still a very real possibility."},
    5:{name:"O. CRUZ",number:"15",position:"IF",fullName:"Oneil Cruz",wbcFlag:"üá©üá¥",mlbId:665833,age:25,height:"6'7\"",weight:"240lbs",battingAvg2025:".200/514AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/players/c/cruzon01.shtml",bio:"Holy cow, could Oneil Cruz be the true heir to the Mendoza Crown? Not only does he play Mario Mendoza's position on the team Mario Mendoza spent most of his career playing for ‚Äî he also hit EXACTLY .200 last year. Not even Mario Mendoza himself ever did that!!"},
    6:{name:"C. MOREL",number:"24",position:"IF",fullName:"Christopher Morel",wbcFlag:null,mlbId:666624,age:26,height:"6'0\"",weight:"200lbs",battingAvg2025:".219/278AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/players/m/morelch01.shtml",bio:"Christopher Morel paints two lines of eye black on his cheeks like Peter Criss from Kiss. Maybe it's more Hello Kitty? Either way, it's pretty goofy. Morel dipped below The Mendoza Line in 2024, & getting back on top last season wasn't enough to keep him from getting DFAd by Tampa Bay last December. He signed a one-year deal to play first base for Miami ‚Äî a position he has never played before in his life. It's <i>Moneyball</i>, y'all! Chris Morel is Chris Pratt!!"},
    7:{name:"D. MOORE",number:"25",position:"IF",fullName:"Dylan Moore",wbcFlag:null,mlbId:664238,age:32,height:"6'0\"",weight:"205lbs",battingAvg2025:".201/219AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/players/m/mooredy01.shtml",bio:"Whether or not \"D-Mo\" even makes a 2026 Major League roster remains to be seen, but his \"stellar\" performance last year was enough to secure the first spot in the 3rd annual Bob Uecker Memorial Race to Two Hundred. Our 2025 \"Champion\" finished one single point above the Mendoza Line, which is pretty dang \"impressive.\" The 2024 Gold Glove-winning Utility Man spent the entirety of his seven-year pro career with Seattle until being released on August 23. Three days later, he was picked up by the same team that drafted him: the Texas Rangers. What a coincidence, a Mendoza Stakes winner playing for 2/3 of Mario Mendoza's teams in one season!"},
    8:{name:"L. ROBERT Jr.",number:"88",position:"OF",fullName:"Luis Robert, Junior",wbcFlag:null,mlbId:673357,age:28,height:"6'3\"",weight:"225lbs",battingAvg2025:".224/395AB",pecota2026:".---/---AB",url:"https://www.baseball-reference.com/players/r/roberlu01.shtml",bio:"The 2021 Chicago White Sox were supposed to be The Future. Now five years removed from seemingly limitless potential and two seasons after claiming the title of \"worst team in history,\" nearly every player from the core built to bring the South Side \"multiple parades\" is gone. Luis Robert, Jr. will spend this summer in Queens, coincidentally replacing last season's Metropolitan Center Fielder, Jose Siri (who may I remind you, broke his dang leg like an actual horse). Junior hit .233 last year and maybe a change of scenery will help ‚Äî even if it's mainly just an airport and scrapyards."},
    9:{name:"TBD-PLAYER-9",number:"",position:"",fullName:"SOON COME (AL)",wbcFlag:null,mlbId:null,age:"TBD",height:"TBD",weight:"TBD",battingAvg2025:".---/---AB",pecota2026:".---/---AB",url:"",bio:""},
    10:{name:"TBD-PLAYER-10",number:"",position:"",fullName:"SOON COME (NL)",wbcFlag:null,mlbId:null,age:"TBD",height:"TBD",weight:"TBD",battingAvg2025:".---/---AB",pecota2026:".---/---AB",url:"",bio:""},
    11:{name:"TBD-PLAYER-11",number:"",position:"",fullName:"SOON COME (NL)",wbcFlag:null,mlbId:null,age:"TBD",height:"TBD",weight:"TBD",battingAvg2025:".---/---AB",pecota2026:".---/---AB",url:"",bio:""}
};

let playersArray = [];

function initializePlayers() {
    playersArray = Object.keys(playerData).map((id, index) => ({
        id: parseInt(id),
        originalOrder: index,
        ...playerData[id],
        currentAvg: null,
        liveAtBats: null,
        liveHits: null,
        distanceFrom200: 1000
    }));
    renderPlayers();
}

function calculateDistanceFrom200(avg) {
    if (avg === null || avg === undefined || isNaN(avg)) return 1000;
    return Math.abs(avg - 0.200);
}

function rankPlayers() {
    playersArray.sort((a, b) => {
        const distA = a.distanceFrom200;
        const distB = b.distanceFrom200;
        if (distA !== distB) return distA - distB;
        return a.originalOrder - b.originalOrder;
    });
}

function getRowClass(index, playersArray) {
    // Check if we have any live data
    const hasLiveData = playersArray.some(p => p.currentAvg !== null && !isNaN(p.currentAvg));
    
    // If no live data yet, just alternate black/yellow
    if (!hasLiveData) {
        return index % 2 === 0 ? 'first-place' : 'second-place';
    }
    
    // With live data, use ranking logic
    if (index === 0) return 'first-place';
    
    const currentDist = playersArray[index].distanceFrom200;
    const prevDist = playersArray[index - 1].distanceFrom200;
    
    if (Math.abs(currentDist - prevDist) < 0.0001) {
        return getRowClass(index - 1, playersArray);
    }
    
    let rank = 1;
    for (let i = 1; i < index; i++) {
        const dist1 = playersArray[i].distanceFrom200;
        const dist2 = playersArray[i - 1].distanceFrom200;
        if (Math.abs(dist1 - dist2) >= 0.0001) {
            rank++;
        }
    }
    
    if (rank === 1) return 'second-place';
    return rank % 2 === 0 ? 'even-place' : 'odd-place';
}

function renderPlayers() {
    const container = document.getElementById('standings-container');
    container.innerHTML = '';
    
    // Check if we're during World Baseball Classic (March 5-17, 2026)
    const now = new Date();
    const wbcStart = new Date('2026-03-05T00:00:00');
    const wbcEnd = new Date('2026-03-17T23:59:59');
    const isWBC = now >= wbcStart && now <= wbcEnd;
    
    // Determine who gets the diamond (‚¨•)
    let diamondPlayerId = null;
    const playersWithData = playersArray.filter(p => p.liveAtBats !== null && p.liveAtBats > 0);
    
    if (playersWithData.length > 0) {
        // Check if any player has reached 200 at-bats
        const playersOver200 = playersWithData.filter(p => p.liveAtBats >= 200);
        
        if (playersOver200.length > 0) {
            // At least one player has 200+ AB: give diamond to closest to .200
            let closestPlayer = playersOver200[0];
            let closestDistance = calculateDistanceFrom200(closestPlayer.currentAvg);
            
            for (let player of playersOver200) {
                const distance = calculateDistanceFrom200(player.currentAvg);
                if (distance < closestDistance) {
                    closestDistance = distance;
                    closestPlayer = player;
                }
            }
            diamondPlayerId = closestPlayer.id;
        } else {
            // No one has 200 AB yet: give diamond to player with most at-bats
            let mostABPlayer = playersWithData[0];
            for (let player of playersWithData) {
                if (player.liveAtBats > mostABPlayer.liveAtBats) {
                    mostABPlayer = player;
                }
            }
            diamondPlayerId = mostABPlayer.id;
        }
    }
    
    playersArray.forEach((player, index) => {
        const rowClass = getRowClass(index, playersArray);
        
        let avgDisplay = '.---';
        let atBatsDisplay = '---AB';
        
        if (player.currentAvg !== null && !isNaN(player.currentAvg)) {
            avgDisplay = player.currentAvg.toFixed(3);
            atBatsDisplay = `${player.liveAtBats || 0}AB`;
        }
        
        // Build the display name with number circle
        let displayName = '';
        
        // Check if TBD player
        const isTBD = player.name.startsWith('TBD-PLAYER');
        
        // Add number diamond if player has a number, or empty diamond if no number
        if (player.number) {
            displayName += `<span class="player-number"><span>${player.number}</span></span>`;
        } else {
            displayName += `<span class="player-number"><span></span></span>`;
        }
        
        // Add player name (wrap in tbd-text span if TBD)
        if (isTBD) {
            displayName += `<span class="tbd-text">${player.name}</span>`;
        } else {
            displayName += player.name;
        }
        
        // Add WBC flag if during WBC and player has a flag
        if (isWBC && player.wbcFlag) {
            displayName += ' ' + player.wbcFlag;
        }
        
        // Add diamond if this player should have it
        if (player.id === diamondPlayerId) {
            displayName += '‚¨•';
        }
        
        const row = document.createElement('div');
        row.className = `player-row ${rowClass}`;
        row.setAttribute('data-player-id', player.id);
        
        const nameClass = isTBD ? 'player-name tbd-line' : 'player-name';
        
        row.innerHTML = `
            <div class="player-info">
                <div class="${nameClass}">${displayName}</div>
                <div class="batting-stats">
                    <div class="batting-display">
                        <div class="batting-average">${avgDisplay}</div>
                        <div class="tap-tooltip">${atBatsDisplay}</div>
                    </div>
                </div>
            </div>
        `;
        
        container.appendChild(row);
    });
    
    attachEventListeners();
}

function attachEventListeners() {
    document.querySelectorAll('.player-name').forEach(el => {
        el.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const playerId = parseInt(this.closest('.player-row').getAttribute('data-player-id'));
            openPlayerModal(playerId);
        });
    });
    
    document.querySelectorAll('.batting-display').forEach(display => {
        display.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.toggle('active');
        });
        
        display.addEventListener('touchend', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.classList.toggle('active');
        });
    });
    
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.batting-display')) {
            document.querySelectorAll('.batting-display').forEach(display => {
                display.classList.remove('active');
            });
        }
    });
    
    document.addEventListener('touchend', function(e) {
        if (!e.target.closest('.batting-display')) {
            document.querySelectorAll('.batting-display').forEach(display => {
                display.classList.remove('active');
            });
        }
    });
}

function openPlayerModal(playerId) {
    const player = playerData[playerId];
    if (!player) return;
    
    const modal = document.getElementById('player-modal');
    
    // Store the current player ID so we can update it when stats refresh
    modal.setAttribute('data-current-player-id', playerId);
    
    const nameEl = document.getElementById('player-modal-name');
    const numberEl = document.getElementById('player-modal-number');
    const positionEl = document.getElementById('player-modal-position');
    
    // Use fullName for modal
    const displayName = player.fullName || player.name;
    
    // Populate the diamond number separately
    if (player.number) {
        numberEl.innerHTML = '<span class="player-number"><span>' + player.number + '</span></span>';
    } else {
        numberEl.innerHTML = '<span class="player-number"><span></span></span>';
    }
    
    // Populate the position badge
    if (player.position) {
        positionEl.innerHTML = '<span class="player-position"><span>' + player.position + '</span></span>';
    } else {
        positionEl.innerHTML = '';
    }
    
    // Convert name to uppercase
    const upperDisplayName = displayName.toUpperCase();
    
    // Build name content (no diamond here)
    let htmlContent = '';
    
    if (player.url && player.url !== '') {
        nameEl.style.cursor = 'pointer';
        nameEl.onclick = function() { window.open(player.url, '_blank'); };
        
        // Parse out suffixes like (AL) or , Jr.
        const match = displayName.match(/^(.+?)(,\s*Jr\.|,\s*Sr\.|,\s*III|,\s*IV|\s+\(.+\))?$/);
        if (match) {
            const name = match[1].toUpperCase();  // Main name without suffix (uppercase)
            const suffix = match[2] ? match[2].toUpperCase() : '';  // Suffix like ", Jr." or " (AL)" (uppercase)
            htmlContent += '<u>' + name + '</u>' + suffix;
        } else {
            htmlContent += '<u>' + upperDisplayName + '</u>';
        }
    } else {
        nameEl.style.cursor = 'default';
        nameEl.onclick = null;
        htmlContent += upperDisplayName;
    }
    
    nameEl.innerHTML = htmlContent;
    
    document.getElementById('player-modal-details').innerHTML = 
        'Age: ' + player.age + ' | Height: ' + player.height + ' | Weight: ' + player.weight;
    
    if (player.battingAvg2025 === '*') {
        document.getElementById('player-modal-2025-stats').innerHTML = 
            '<strong>2025* Batting Avg./At Bats: ' + player.battingAvgValue + '</strong>';
    } else {
        document.getElementById('player-modal-2025-stats').innerHTML = 
            '<strong>2025 Batting Avg./At Bats: ' + player.battingAvg2025 + '</strong>';
    }
    
    document.getElementById('player-modal-2026-stats').innerHTML = 
        '<strong>2026 PECOTA Projection: ' + player.pecota2026 + '</strong>';
    
    // Get live player data from playersArray
    const livePlayer = playersArray.find(p => p.id === playerId);
    let currentStatsText = '---/---AB';
    
    if (livePlayer && livePlayer.currentAvg !== null && !isNaN(livePlayer.currentAvg)) {
        const avg = livePlayer.currentAvg.toFixed(3);
        const ab = livePlayer.liveAtBats || 0;
        currentStatsText = `${avg}/${ab}AB`;
    }
    
    document.getElementById('player-modal-current-stats').innerHTML = 
        '<strong>Current Stats: ' + currentStatsText + '</strong>';
    
    if (player.games) {
        document.getElementById('player-modal-games').textContent = '*' + player.games;
    } else {
        document.getElementById('player-modal-games').textContent = '';
    }
    
    const screwDiv = document.getElementById('player-modal-screw');
    if (player.bio && player.bio.trim() !== '') {
        screwDiv.innerHTML = player.bio;
    } else {
        screwDiv.textContent = 'SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME SOON COME';
    }
    
    // Fetch player status and trend
    fetchPlayerStatusAndTrend(playerId);
    
    // Set team designation
    const teamDesignationEl = document.getElementById('player-team-designation');
    const teamDesignations = {
        1: 'Senior Circuit',
        2: 'Junior Circuit',
        3: 'Junior Circuit',
        4: 'Junior Circuit',
        5: 'Senior Circuit',
        6: 'Senior Circuit',
        7: 'Junior Circuit',
        8: 'Senior Circuit'
    };
    teamDesignationEl.innerHTML = teamDesignations[playerId] || '';
    
    openModalWithScroll(modal);
}

async function fetchPlayerStatusAndTrend(playerId) {
    const player = playerData[playerId];
    const statusEl = document.getElementById('player-status');
    const trendEl = document.getElementById('player-trend');
    
    // Check current date for season status
    const now = new Date();
    const springTrainingStart = new Date('2026-02-15'); // Spring training typically starts mid-February
    const openingDay = new Date('2026-03-25'); // Opening day per site info
    
    // Default to season status
    if (now < springTrainingStart) {
        statusEl.textContent = 'WINTER';
        trendEl.textContent = '---';
        return;
    } else if (now < openingDay) {
        statusEl.textContent = 'SPRING';
        trendEl.textContent = '---';
        return;
    }
    
    // Reset for loading during season
    statusEl.textContent = 'LOADING';
    trendEl.textContent = '---';
    
    if (!player.mlbId) {
        statusEl.textContent = 'TBD';
        return;
    }
    
    try {
        // Fetch player info to get status and recent stats
        const response = await fetch(
            `https://statsapi.mlb.com/api/v1/people/${player.mlbId}?hydrate=currentTeam,stats(group=[hitting],type=[gameLog],season=2026)`
        );
        
        if (!response.ok) {
            statusEl.textContent = 'ERROR';
            return;
        }
        
        const data = await response.json();
        const person = data.people[0];
        
        // Determine status
        let status = 'FREE AGENT';
        if (person.currentTeam) {
            const teamId = person.currentTeam.id;
            // MLB teams are IDs 108-158 (approximately)
            if (teamId >= 108 && teamId <= 158) {
                // Check if injured
                if (person.status && person.status.code === 'D60') {
                    status = 'INJURED';
                } else {
                    status = 'ACTIVE';
                }
            } else {
                // Minor league team - check level
                if (person.currentTeam.name) {
                    const teamName = person.currentTeam.name.toUpperCase();
                    if (teamName.includes('AAA') || teamName.includes('TRIPLE')) {
                        status = 'AAA';
                    } else if (teamName.includes('AA') || teamName.includes('DOUBLE')) {
                        status = 'AA';
                    } else if (teamName.includes('A+') || teamName.includes('HIGH')) {
                        status = 'A+';
                    } else {
                        status = 'A';
                    }
                }
            }
        }
        
        statusEl.textContent = status;
        
        // Determine trend from game log
        if (person.stats && person.stats.length > 0) {
            const gameLog = person.stats.find(s => s.type.displayName === 'gameLog');
            if (gameLog && gameLog.splits && gameLog.splits.length >= 2) {
                const splits = gameLog.splits;
                // Get last two games with at-bats
                const recentGames = splits.filter(g => g.stat && g.stat.atBats > 0).slice(0, 2);
                
                if (recentGames.length >= 2) {
                    const lastGame = recentGames[0].stat;
                    const prevGame = recentGames[1].stat;
                    
                    const lastAvg = lastGame.atBats > 0 ? lastGame.hits / lastGame.atBats : 0;
                    const prevAvg = prevGame.atBats > 0 ? prevGame.hits / prevGame.atBats : 0;
                    
                    if (lastAvg > prevAvg) {
                        trendEl.textContent = 'AVG‚Üë';
                    } else if (lastAvg < prevAvg) {
                        trendEl.textContent = 'AVG‚Üì';
                    } else {
                        trendEl.textContent = 'AVG‚Üí';
                    }
                }
            }
        }
    } catch (error) {
        console.error('Error fetching player status:', error);
        statusEl.textContent = 'ERROR';
    }
}

async function fetchMLBStats() {
    try {
        for (let player of playersArray) {
            if (!player.mlbId) continue;
            
            try {
                const response = await fetch(
                    `https://statsapi.mlb.com/api/v1/people/${player.mlbId}?hydrate=stats(group=[hitting],type=[season],season=2026)`
                );
                
                if (!response.ok) continue;
                
                const data = await response.json();
                const person = data.people[0];
                
                if (person.stats && person.stats.length > 0) {
                    const hittingStats = person.stats.find(s => 
                        s.group.displayName === 'hitting' && s.type.displayName === 'season'
                    );
                    
                    if (hittingStats && hittingStats.splits && hittingStats.splits.length > 0) {
                        const stats = hittingStats.splits[0].stat;
                        player.currentAvg = parseFloat(stats.avg) || 0;
                        player.liveAtBats = stats.atBats || 0;
                        player.liveHits = stats.hits || 0;
                        player.distanceFrom200 = calculateDistanceFrom200(player.currentAvg);
                    }
                }
            } catch (err) {
                console.error(`Error fetching stats for ${player.name}:`, err);
            }
        }
        
        rankPlayers();
        renderPlayers();
        
        // Update player modal if it's currently open
        updateOpenPlayerModal();
        
    } catch (error) {
        console.error('Error fetching MLB stats:', error);
    }
}

// Function to update player modal stats if modal is currently open
function updateOpenPlayerModal() {
    const playerModal = document.getElementById('player-modal');
    if (!playerModal || !playerModal.classList.contains('open')) {
        return; // Modal not open, nothing to update
    }
    
    // Get the currently displayed player by checking which row was clicked
    // We'll need to store this when opening the modal
    const currentPlayerId = playerModal.getAttribute('data-current-player-id');
    if (!currentPlayerId) return;
    
    const livePlayer = playersArray.find(p => p.id === parseInt(currentPlayerId));
    if (!livePlayer) return;
    
    // Update current stats display
    let currentStatsText = '---/---AB';
    if (livePlayer.currentAvg !== null && !isNaN(livePlayer.currentAvg)) {
        const avg = livePlayer.currentAvg.toFixed(3);
        const ab = livePlayer.liveAtBats || 0;
        currentStatsText = `${avg}/${ab}AB`;
    }
    
    document.getElementById('player-modal-current-stats').innerHTML = 
        '<strong>Current Stats: ' + currentStatsText + '</strong>';
}

initializePlayers();
setTimeout(fetchMLBStats, 2000);
setInterval(fetchMLBStats, 11000); // Update every 11 seconds - diamond animation signals update

// Function to check if any of our players' games are currently active
async function checkGameStatus() {
    try {
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD format
        
        // Get list of our players with MLB IDs
        const ourPlayers = playersArray.filter(p => p.mlbId);
        
        if (ourPlayers.length === 0) {
            pauseLiveAnimation();
            return;
        }
        
        let anyGameActive = false;
        
        // Check each player's team schedule for today
        for (let player of ourPlayers) {
            try {
                // Get player's current team
                const personResponse = await fetch(
                    `https://statsapi.mlb.com/api/v1/people/${player.mlbId}?hydrate=currentTeam`
                );
                
                if (!personResponse.ok) continue;
                
                const personData = await personResponse.json();
                const person = personData.people[0];
                
                if (!person.currentTeam) continue;
                
                const teamId = person.currentTeam.id;
                
                // Get today's schedule for this team
                const scheduleResponse = await fetch(
                    `https://statsapi.mlb.com/api/v1/schedule?sportId=1&teamId=${teamId}&date=${dateStr}`
                );
                
                if (!scheduleResponse.ok) continue;
                
                const scheduleData = await scheduleResponse.json();
                
                if (scheduleData.dates && scheduleData.dates.length > 0) {
                    const games = scheduleData.dates[0].games;
                    
                    for (let game of games) {
                        const status = game.status.abstractGameState;
                        // Game is active if it's "Live" (in progress)
                        if (status === 'Live') {
                            anyGameActive = true;
                            break;
                        }
                    }
                }
                
                if (anyGameActive) break;
                
            } catch (err) {
                console.error(`Error checking game status for player ${player.name}:`, err);
            }
        }
        
        // Control the wave animation based on game status
        if (anyGameActive) {
            playLiveAnimation();
        } else {
            pauseLiveAnimation();
        }
        
    } catch (error) {
        console.error('Error in checkGameStatus:', error);
        pauseLiveAnimation();
    }
}

function playLiveAnimation() {
    const liveLetters = document.querySelectorAll('.live-letter');
    liveLetters.forEach(letter => {
        letter.classList.remove('paused');
    });
}

function pauseLiveAnimation() {
    const liveLetters = document.querySelectorAll('.live-letter');
    liveLetters.forEach(letter => {
        letter.classList.add('paused');
    });
}

// Start with paused animation
pauseLiveAnimation();

// Check game status every 30 seconds (don't need to check as frequently as stats)
setInterval(checkGameStatus, 30000);
// Do initial check after a brief delay
setTimeout(checkGameStatus, 5000);

const link=document.createElement('link');
link.rel='icon';
link.href='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect x=%2225%22 y=%2225%22 width=%2250%22 height=%2250%22 fill=%22%23c5e5f0%22 transform=%22rotate(45 50 50)%22/></svg>';
document.head.appendChild(link);

// Global modal functions with scroll preservation
let scrollY = 0;

function openModalWithScroll(modal) {
    scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;
    modal.classList.add('open');
    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollY}px`;
    document.body.style.width = '100%';
    document.body.style.overflow = 'hidden';
}

function closeModalWithScroll(modal) {
    modal.classList.remove('open');
    const scrollPosition = scrollY;
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';
    document.body.style.overflow = '';
    window.scrollTo(0, scrollPosition);
    scrollY = 0;
}

document.addEventListener('DOMContentLoaded',function(){
    const rulesModal=document.getElementById('rules-modal');
    const playerModal=document.getElementById('player-modal');
    const contactModal=document.getElementById('contact-modal');
    const rulesTrigger=document.getElementById('rules-trigger');
    const contactTrigger=document.getElementById('contact-trigger');
    
    rulesTrigger.addEventListener('click',function(e){
        e.preventDefault();
        openModalWithScroll(rulesModal);
    });
    
    contactTrigger.addEventListener('click',function(e){
        e.preventDefault();
        openModalWithScroll(contactModal);
    });
    
    document.querySelectorAll('.close').forEach(btn=>{
        btn.addEventListener('click',function(){
            const modalType=this.getAttribute('data-modal');
            if(modalType==='rules'){
                closeModalWithScroll(rulesModal);
            }else if(modalType==='player'){
                closeModalWithScroll(playerModal);
            }else if(modalType==='contact'){
                closeModalWithScroll(contactModal);
            }else if(modalType==='horse'){
                closeModalWithScroll(document.getElementById('horse-modal'));
            }
        });
    });
    
    window.addEventListener('click',function(event){
        if(event.target==rulesModal){
            closeModalWithScroll(rulesModal);
        }
        if(event.target==playerModal){
            closeModalWithScroll(playerModal);
        }
        if(event.target==contactModal){
            closeModalWithScroll(contactModal);
        }
        const horseModal=document.getElementById('horse-modal');
        if(event.target==horseModal){
            closeModalWithScroll(horseModal);
        }
    });
    
    document.getElementById('contact-form').addEventListener('submit',function(e){
        const submitBtn=this.querySelector('.contact-submit-btn');
        submitBtn.textContent="& THEY'RE OFF!!";
        submitBtn.disabled=true;
    });
});

function updateCountdown(){
    const now = new Date().getTime();
    
    // Define key dates
    const springTraining = new Date('2026-02-15T00:00:00').getTime();  // Spring Training starts
    const openingDay = new Date('2026-03-25T00:00:00').getTime();      // Opening Day / Post Time
    const allStarBreakStart = new Date('2026-07-11T00:00:00').getTime(); // All-Star Break starts
    const allStarBreakEnd = new Date('2026-07-15T00:00:00').getTime();   // All-Star Break ends
    const finishLine = new Date('2026-09-27T23:59:59').getTime();      // End of season
    
    let targetDate, labelText;
    
    // Determine which phase we're in and set target accordingly
    if (now < springTraining) {
        // Before Spring Training
        targetDate = springTraining;
        labelText = 'TO SPRING TRAINING';
    } else if (now < openingDay) {
        // During Spring Training
        targetDate = openingDay;
        labelText = 'TO POST TIME';
    } else if (now < allStarBreakStart) {
        // During first half of season
        targetDate = allStarBreakStart;
        labelText = 'TO ALL-STAR BREAK';
    } else if (now < allStarBreakEnd) {
        // During All-Star Break
        targetDate = allStarBreakEnd;
        labelText = 'TO 2nd HALF';
    } else if (now < finishLine) {
        // During second half
        targetDate = finishLine;
        labelText = 'TO FINISH LINE';
    } else {
        // Season is over
        document.getElementById('countdown-timer').textContent = '00:00:00:00';
        document.getElementById('live-indicator').innerHTML = '<span id="countdown-timer">00:00:00:00</span> SEASON COMPLETE';
        return;
    }
    
    const distance = targetDate - now;
    
    if (distance < 0) {
        document.getElementById('countdown-timer').textContent = '00:00:00:00';
        return;
    }
    
    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
    const formatted = String(days).padStart(2, '0') + ':' +
                      String(hours).padStart(2, '0') + ':' +
                      String(minutes).padStart(2, '0') + ':' +
                      String(seconds).padStart(2, '0');
    
    document.getElementById('countdown-timer').textContent = formatted;
    document.getElementById('live-indicator').innerHTML = `<span id="countdown-timer">${formatted}</span> ${labelText}`;
}

updateCountdown();
setInterval(updateCountdown, 1000);

const staticMessages=['Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Our 11th "Glorious" Season','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','"Congratulations" to 2025 Champ D. Moore','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','It\'s the 3rd Race to Two Hundred!','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','Next Race: Mar 25 ‚Äì Sept 27','R.I.P. Mister Baseball','Diamond Life','Diamond Life!!!!!!!!!!!','Your Perfect Fantasy','Mario\'s Eleventh Affair'];

let lastMessage=localStorage.getItem('lastMessage')||'';
let randomIndex;
let newMessage;

do{
    randomIndex=Math.floor(Math.random()*staticMessages.length);
    newMessage=staticMessages[randomIndex];
}while(newMessage===lastMessage);

localStorage.setItem('lastMessage',newMessage);
document.querySelector('.hits-squares-text').textContent=newMessage;

// Call to the Post bugle sound effect
const bugleTrigger = document.getElementById('bugle-trigger');
if (bugleTrigger) {
    bugleTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const now = audioContext.currentTime;
        
        // Function to play a note
        function playNote(freq, startTime, duration) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, startTime);
            
            gain.gain.setValueAtTime(0.3, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
            
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            osc.start(startTime);
            osc.stop(startTime + duration);
        }
        
        // Notes for racetrack melody
        const C4 = 261.63;  // C4 (low C)
        const F4 = 349.23;  // F4
        const A4 = 440.00;  // A4
        const C5 = 523.25;  // C5 (high C)
        
        let t = now;
        
        // First phrase: F A CCC [pause] AAA [pause] FAFC (C goes DOWN)
        playNote(F4, t, 0.3);
        t += 0.3;
        playNote(A4, t, 0.3);
        t += 0.3;
        playNote(C5, t, 0.2);
        t += 0.2;
        playNote(C5, t, 0.2);
        t += 0.2;
        playNote(C5, t, 0.3);
        t += 0.3;
        t += 0.2; // pause
        playNote(A4, t, 0.2);
        t += 0.2;
        playNote(A4, t, 0.2);
        t += 0.2;
        playNote(A4, t, 0.3);
        t += 0.3;
        t += 0.2; // pause
        playNote(F4, t, 0.2);
        t += 0.2;
        playNote(A4, t, 0.2);
        t += 0.2;
        playNote(F4, t, 0.2);
        t += 0.2;
        playNote(C4, t, 0.3);  // C goes DOWN to C4
        t += 0.3;
        t += 0.4; // double pause
        
        // Second phrase: F A CCC [pause] AAA [pause] CCCF (Cs are LOW C4, F goes UP)
        playNote(F4, t, 0.3);
        t += 0.3;
        playNote(A4, t, 0.3);
        t += 0.3;
        playNote(C5, t, 0.2);
        t += 0.2;
        playNote(C5, t, 0.2);
        t += 0.2;
        playNote(C5, t, 0.3);
        t += 0.3;
        t += 0.2; // pause
        playNote(A4, t, 0.2);
        t += 0.2;
        playNote(A4, t, 0.2);
        t += 0.2;
        playNote(A4, t, 0.3);
        t += 0.3;
        t += 0.2; // pause
        playNote(C4, t, 0.2);  // LOW C4
        t += 0.2;
        playNote(C4, t, 0.2);  // LOW C4
        t += 0.2;
        playNote(C4, t, 0.2);  // LOW C4
        t += 0.2;
        playNote(F4, t, 0.4);  // F goes UP
        t += 0.4;
        
        // Calculate total song duration
        const totalDuration = t - now;
        
        // Open horse animation modal
        const horseModal = document.getElementById('horse-modal');
        openModalWithScroll(horseModal);
        
        // Get first place player's number
        const firstPlacePlayer = playersArray.length > 0 ? playersArray[0] : null;
        const firstPlaceNumber = firstPlacePlayer && firstPlacePlayer.number ? firstPlacePlayer.number.toString().padStart(2, ' ') : '??';
        
        // Get all player numbers from playerData (players 2-11 for the pack)
        const player2Num = (playerData[2].number || '??').toString().padStart(2, ' ');
        const player3Num = (playerData[3].number || '??').toString().padStart(2, ' ');
        const player4Num = (playerData[4].number || '??').toString().padStart(2, ' ');
        const player5Num = (playerData[5].number || '??').toString().padStart(2, ' ');
        const player6Num = (playerData[6].number || '??').toString().padStart(2, ' ');
        const player7Num = (playerData[7].number || '??').toString().padStart(2, ' ');
        const player8Num = (playerData[8].number || '??').toString().padStart(2, ' ');
        const player9Num = (playerData[9].number || '??').toString().padStart(2, ' ');
        const player10Num = (playerData[10].number || '??').toString().padStart(2, ' ');
        const player11Num = (playerData[11].number || '??').toString().padStart(2, ' ');
        
        // Opening text
        const openingFrame = `

...& they're OFF!!!







`;
        
        // Horse animation frames - truly independent movement, text locked separately below
        const horseFrames = [
            // Frame 1 - Each horse has unique leg position
            `
          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player11Num}  ( \`'    //(  ${player10Num}  ( \`'     //(  ${player9Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`   \\     \\        \`  \\      \\         \`     \\   \\
        \\     \\            \\      \\              \\   \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player8Num}  ( \`'    //(  ${player7Num}  ( \`'     //(  ${player6Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`     \\   \\        \`   \\     \\         \`  \\      \\
          \\   \\            \\     \\             \\      \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player5Num}  ( \`'    //(  ${player4Num}  ( \`'     //(  ${player3Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`  \\      \\        \`     \\   \\         \`   \\     \\
       \\      \\              \\   \\            \\     \\

                .''                             .''
        ._.-.___.' (\`\\                 ._.-.___.' (\`\\
       //(  ${player2Num}  ( \`'                 //(  ${firstPlaceNumber}  ( \`'
      '/ )\\ ).__. )                   '/ )\\ ).__. )
      ' <' \`\\ ._/'\\                   ' <' \`\\ ._/'\\
         \`    \\    \\                     \`  \\      \\
               \\    \\                         \\      \\
`,
            // Frame 2 - Different leg positions for each horse
            `
          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player11Num}  ( \`'    //(  ${player10Num}  ( \`'     //(  ${player9Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`    \\    \\        \`     \\   \\         \`  \\      \\
         \\    \\              \\   \\             \\      \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player8Num}  ( \`'    //(  ${player7Num}  ( \`'     //(  ${player6Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`  \\      \\        \`    \\    \\         \`     \\   \\
       \\      \\             \\    \\              \\   \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player5Num}  ( \`'    //(  ${player4Num}  ( \`'     //(  ${player3Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`     \\   \\        \`  \\      \\         \`    \\    \\
          \\   \\            \\      \\              \\    \\

                .''                             .''
        ._.-.___.' (\`\\                 ._.-.___.' (\`\\
       //(  ${player2Num}  ( \`'                 //(  ${firstPlaceNumber}  ( \`'
      '/ )\\ ).__. )                   '/ )\\ ).__. )
      ' <' \`\\ ._/'\\                   ' <' \`\\ ._/'\\
         \`  \\      \\                     \`     \\   \\
             \\      \\                          \\   \\
`,
            // Frame 3 - More varied leg positions
            `
          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player11Num}  ( \`'    //(  ${player10Num}  ( \`'     //(  ${player9Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`  \\      \\        \`   \\     \\         \`    \\    \\
       \\      \\            \\     \\              \\    \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player8Num}  ( \`'    //(  ${player7Num}  ( \`'     //(  ${player6Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`   \\     \\        \`  \\      \\         \`  \\      \\
        \\     \\            \\      \\             \\      \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player5Num}  ( \`'    //(  ${player4Num}  ( \`'     //(  ${player3Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`     \\   \\        \`   \\     \\         \`  \\      \\
          \\   \\            \\     \\             \\      \\

                .''                             .''
        ._.-.___.' (\`\\                 ._.-.___.' (\`\\
       //(  ${player2Num}  ( \`'                 //(  ${firstPlaceNumber}  ( \`'
      '/ )\\ ).__. )                   '/ )\\ ).__. )
      ' <' \`\\ ._/'\\                   ' <' \`\\ ._/'\\
         \`     \\   \\                     \`   \\     \\
                \\   \\                         \\     \\
`,
            // Frame 4 - Continue varied movement
            `
          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player11Num}  ( \`'    //(  ${player10Num}  ( \`'     //(  ${player9Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`     \\   \\        \`    \\    \\         \`   \\     \\
          \\   \\             \\    \\            \\     \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player8Num}  ( \`'    //(  ${player7Num}  ( \`'     //(  ${player6Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`    \\    \\        \`     \\   \\         \`   \\     \\
         \\    \\              \\   \\            \\     \\

          .''                .''                 .''
  ._.-.___.' (\`\\    ._.-.___.' (\`\\     ._.-.___.' (\`\\
 //(  ${player5Num}  ( \`'    //(  ${player4Num}  ( \`'     //(  ${player3Num}  ( \`'
'/ )\\ ).__. )      '/ )\\ ).__. )       '/ )\\ ).__. )
' <' \`\\ ._/'\\      ' <' \`\\ ._/'\\       ' <' \`\\ ._/'\\
   \`  \\      \\        \`    \\    \\         \`     \\   \\
       \\      \\             \\    \\              \\   \\

                .''                             .''
        ._.-.___.' (\`\\                 ._.-.___.' (\`\\
       //(  ${player2Num}  ( \`'                 //(  ${firstPlaceNumber}  ( \`'
      '/ )\\ ).__. )                   '/ )\\ ).__. )
      ' <' \`\\ ._/'\\                   ' <' \`\\ ._/'\\
         \`   \\     \\                     \`    \\    \\
              \\     \\                          \\    \\
`
        ];

        // Check current date for race mode
        const currentDate = new Date();
        const openingDay = new Date('2026-03-25T00:00:00');
        const allStarBreak = new Date('2026-07-11T00:00:00');
        const isSeasonActive = currentDate >= openingDay;
        const isPostAllStarBreak = currentDate >= allStarBreak;
        
        // Prepare race announcements if season is active
        let raceAnnouncementText = '';
        let countdownText = '';
        
        if (isSeasonActive) {
            let top3Players = [];
            
            if (isPostAllStarBreak) {
                // POST ALL-STAR BREAK: Race for .200
                let sortedBy200 = [...playersArray]
                    .filter(p => !p.name.startsWith('TBD') && p.currentAvg !== null && !isNaN(p.currentAvg))
                    .sort((a, b) => a.distanceFrom200 - b.distanceFrom200);
                
                top3Players = sortedBy200.slice(0, 3).map((p, idx) => {
                    let distanceText;
                    const avg = p.currentAvg;
                    
                    if (Math.abs(avg - 0.200) < 0.0001) {
                        distanceText = 'GIDDYUP!!';
                    } else {
                        const distance = Math.abs(Math.round((avg - 0.200) * 1000));
                        distanceText = `${distance} AWAY`;
                    }
                    
                    return `${idx + 1}${idx === 0 ? 'st' : idx === 1 ? 'nd' : 'rd'}: ${p.number || '??'} ${p.name} ${distanceText}`;
                });
                
                // Calculate days until end of season (Sept 27, 2026)
                const endOfSeason = new Date('2026-09-27T23:59:59');
                const daysLeft = Math.max(0, Math.ceil((endOfSeason - currentDate) / (1000 * 60 * 60 * 24)));
                countdownText = `${daysLeft} Days 'til The Finish!!`;
                
            } else {
                // PRE ALL-STAR BREAK: Race for 200AB
                let sortedByAB = [...playersArray]
                    .filter(p => !p.name.startsWith('TBD'))
                    .sort((a, b) => (b.liveAtBats || 0) - (a.liveAtBats || 0));
                
                top3Players = sortedByAB.slice(0, 3).map((p, idx) => {
                    const abDisplay = p.liveAtBats ? `${p.liveAtBats}AB` : '0AB';
                    return `${idx + 1}${idx === 0 ? 'st' : idx === 1 ? 'nd' : 'rd'}: ${p.number || '??'} ${p.name} ${abDisplay}`;
                });
                
                // Calculate days until All-Star Break
                const daysUntilBreak = Math.max(0, Math.ceil((allStarBreak - currentDate) / (1000 * 60 * 60 * 24)));
                countdownText = `${daysUntilBreak} Days 'til The Break!!`;
            }
            
            // Build the race announcement text (will display progressively)
            if (top3Players.length >= 3) {
                raceAnnouncementText = top3Players.join('\n');
            }
        }






        
        let currentFrame = 0;
        let horseInterval;
        const horseElement = document.getElementById('horse-animation');
        const horseText = document.getElementById('horse-text');
        
        // Reset horse text to hidden at start
        if (horseText) {
            horseText.style.visibility = 'hidden';
            horseText.textContent = '';
        }
        
        // Show opening text
        horseElement.textContent = openingFrame;
        
        function animateHorse() {
            horseElement.textContent = horseFrames[currentFrame];
            currentFrame = (currentFrame + 1) % horseFrames.length;
        }
        
        // Wait 1 second, then start horse animation
        setTimeout(() => {
            animateHorse();
            horseInterval = setInterval(animateHorse, 200); // Faster animation for smoother gallop
        }, 1000);
        
        // If season is active, show race announcements progressively
        if (isSeasonActive && raceAnnouncementText) {
            const lines = raceAnnouncementText.split('\n');
            
            // Show 1st place (0.5 seconds into animation)
            setTimeout(() => {
                if (horseText && lines[0]) {
                    horseText.textContent = lines[0];
                    horseText.style.visibility = 'visible';
                }
            }, 1500);
            
            // Show 1st + 2nd place (1 second later)
            setTimeout(() => {
                if (horseText && lines[1]) {
                    horseText.textContent = lines[0] + '\n' + lines[1];
                }
            }, 2500);
            
            // Show all 3 places (1 second later)
            setTimeout(() => {
                if (horseText && lines[2]) {
                    horseText.textContent = raceAnnouncementText;
                }
            }, 3500);
        } else {
            // Pre-season: Show "Look @ 'em go!!" text in the second half of the song
            setTimeout(() => {
                const horseText = document.getElementById('horse-text');
                if (horseText) {
                    horseText.textContent = "Look @ 'em go!!";
                    horseText.style.visibility = 'visible';
                }
            }, (totalDuration * 0.6) * 1000);
        }
        
        // Stop animation and show countdown if season is active
        setTimeout(() => {
            if (horseInterval) {
                clearInterval(horseInterval);
            }
            
            // If season is active, show countdown screen
            if (isSeasonActive && countdownText) {
                // Hide race announcements
                if (horseText) {
                    horseText.style.visibility = 'hidden';
                    horseText.textContent = '';
                }
                
                // Show countdown
                const countdownFrame = `








${countdownText}








                `;
                horseElement.textContent = countdownFrame;
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    const horseModal = document.getElementById('horse-modal');
                    closeModalWithScroll(horseModal);
                }, 2000);
            } else {
                // Pre-season: Show countdown to Opening Day
                if (horseText) {
                    horseText.style.visibility = 'hidden';
                    horseText.textContent = '';
                }
                
                // Calculate days until Opening Day
                const openingDay = new Date('2026-03-25T00:00:00');
                const now = new Date();
                const daysUntilOpening = Math.max(0, Math.ceil((openingDay - now) / (1000 * 60 * 60 * 24)));
                
                // Show pre-season countdown frame
                const preSeasonCountdownFrame = `








${daysUntilOpening} Days 'til Post Time!!








                `;
                horseElement.textContent = preSeasonCountdownFrame;
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    const horseModal = document.getElementById('horse-modal');
                    closeModalWithScroll(horseModal);
                }, 2000);
            }
        }, totalDuration * 1000);
    });
}
    </script>
</body>
</html>
